{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
    	<title>Lightning: 154 PGP Genomes, unphased</title>
		<!-- Bootstrap CSS -->
		<link href="{% static 'slippy/js/bootstrap-3.2.0-dist/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
		<!-- CSS theme -->
		<link href="{% static 'slippy/js/bootstrap-3.2.0-dist/css/bootstrap-theme.min.css' %}" rel="stylesheet" type="text/css">
    
    	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	
		<!--<link href="{% static 'slippy/js/jquery-ui-1.11.1.custom/jquery-ui.min.css' %}" rel="stylesheet" type="text/css">
		<link href="{% static 'slippy/js/jquery-ui-1.11.1.custom/jquery-ui.structure.min.css' %}" rel="stylesheet" type="text/css">
		<link href="{% static 'slippy/js/jquery-ui-1.11.1.custom/jquery-ui.theme.min.css' %}" rel="stylesheet" type="text/css">-->
		<style>
			.highlight{
				opacity: 0.4;
				filter: alpha(opacity=40);
				border: 1px solid #0A7EbE;
				outline: 10px auto #0A7EbE;
				background-color: white;
			}
			.highlight.broken{
				border: 1px solid #be4a0a;
				outline: 10px auto #be4a0a;
			}
			.highlight:hover, .highlight:focus{
				filter: alpha(opacity=70);
				opacity: 0.7;
				background-color: transparent;
			}
			.navigator .highlight{
				opacity: 0.4;
				filter: alpha(opacity=40);
				border: 2px solid #900;
				outline: none;
				background-color: #900;
			}
			#progressbar {
				margin-top: 20px;
			}
			.progress-label {
				font-weight: bold;
				text-shadow: 1px 1px 0 #fff;
			}
			.ui-dialog-titlebar-close {
				display: none;
			}
			 label {
				display: block;
			}
			select {
				width: 200px;
			}
			.overflow {
				height: 200px;
			}
			body {
				padding-top:50px; /* padding necessary for having the navbar and bootstrap there */
			}
		</style>
	</head>
	<body>
		<script src="{% static 'slippy/js/d3.min.js' %}"></script>
		<script src="{% static 'slippy/js/openseadragon.min.js' %}"></script>
		<script src="{% static 'slippy/js/openseadragon-viewerinputhook.js' %}"></script>
		<script src="{% static 'slippy/js/openseadragon-imaginghelper.min.js' %}"></script>
		<script src="{% static 'slippy/js/jquery-1.10.1.min.js' %}"></script>
		<!--<script src="{% static 'slippy/js/jquery-ui-1.11.1.custom/jquery-ui.min.js' %}"></script>-->
		<!-- Bootstrap JavaScript -->
		<script src="{% static 'slippy/js/bootstrap-3.2.0-dist/js/bootstrap.min.js' %}"></script>

		<script src="{% static 'slippy/js/functions-bootstrap.js' %}"></script>
		<!--<script src="{% static 'slippy/js/loading-genes-select.js' %}"></script>-->

		<script>
			//Defines global variables "tilePixelSize" and "borderPixelSize" 
			//TODO: tilePixelSize and borderPixelSize input from django
			tilePixelSize = 15*2;
			borderPixelSize = 2;
			/* Search functionality for genes - run when main form is submitted
			/		If the text in the text input (#geneName) is empty, show an alert saying that
			/		Otherwise, submit the search to django using ajax. When done, run displayResults
			/ */
			var searchGene = function(){
				var geneName = jQuery("#geneName").val();
				if (geneName != ""){
					var data = { geneName:geneName};
					var args = { type:"GET", url:"{%url 'slippy:simplesearch' %}", data:data, complete:displayResults };
					jQuery.ajax(args);
				}
				else {
					alert("Enter a gene to search");
				}
				return false;
			};
			/* Specific Search functionality for genes - run after modal has been shown and the Load Genes button there has been pressed
			/		If no genes in the geneSelected radio/checkbox input form are checked,
			/			show an alert informing the 
			/		Otherwise, submit the search to django using ajax (specificsearch). When the ajax request is done, run displayResults
			/			After submitting the search, hide the modal and clear the radio/checkbox input form options
			/ */
			//TODO: add checkbox functionality
			var specificSearchGene = function() {
				var geneName = jQuery("input[name='geneSelected']:checked");
				if (geneName.length > 0){
					geneName = geneName.val();
					var args = { type:"GET", url:"{%url 'slippy:specificsearch' %}", data:{geneName:geneName}, complete:displayResults };
					jQuery.ajax(args);
					jQuery("#modal-form").modal('hide');
					jQuery("#GeneOptions").empty();
				}
				else {
					alert("Select a gene or press Cancel");
				}
				return false;
			};
			/* Display Found genes (if successful, otherwise show the response text from django)
			/		If the first parameter is "single," only one result was returned, display it 
			/		Otherwise, for each parameter, add a radio button named geneSelected
			/			Add all these radio buttons to #GeneOptions, the modal-body. Then show the modal.
			/ */
			//TODO: add checkbox functionality
			//TODO: exit functionality - automatically clear #GeneOptions instead of clearing on load
			var displayResults = function(res, status) {
				if (status == "success") {
					var param = res.responseText.replace(/\s/g, '').split(';');
					if (param[0] == "single"){
						addGeneAnnotation(param[1], parseInt(param[2]), parseInt(param[3]), parseInt(param[4]), parseInt(param[5]), tilePixelSize, borderPixelSize, "{% static 'slippy/iter.txt' %}", true, param.slice(6));
					} else {
						var textToAppend = '';
						param.forEach(function(geneName) {
							if (geneName != "multiple" && geneName != ""){
								textToAppend = textToAppend.concat('<label><input type="radio" name="geneSelected" value="', geneName, '"> ', geneName, ' </label>');
							}
						});
						jQuery("#GeneOptions").empty();
						jQuery("#GeneOptions").append(textToAppend);
						jQuery("#modal-form").modal('show');
					}
				}
				else {
					alert(res.responseText);
				}
			};
			/* Set up page
			/		Format the slippy map to fill the window, excluding 75px for toolbar 
			/		Add searchGene function to the Gene Search form (in navbar)
			/		Add specificSearchGene function to the button in modal
			/ 		Automatically clear the text in the Gene Search box when page is loaded
			/ 		Automatically clear the text in any search box when focus is brought to it
			/ */
			jQuery(document).ready(function () {
				//loadGenesWithProgress("{% static 'slippy/iter.txt' %}", "{%url 'slippy:loadall' %}")
        		var content = jQuery("#contentDiv"),
        			h = jQuery(window).height();
    			content.css("height", h-75); 
				jQuery("#searchForm").submit(searchGene);
				jQuery("#loadSpecificGene").click(specificSearchGene);
				jQuery("#geneName:text").val('');
				jQuery("input:text").focus(function() { jQuery(this).val('');});
    			beginDragon("{% static 'slippy/TileNumSupertiles.csv' %}", tilePixelSize, borderPixelSize,
							"{% static 'slippy/offsets.txt' %}", "{% static 'slippy/pngs/entire.dzi' %}",
							"{% static 'slippy/js/openseadragon-images/' %}", "{% static 'slippy/iter.txt' %}");
			});
		</script>

		<div id="overlaytexts"></div>
		<div id="dialog-form" style="display:none;overflow:none"></div>
		<div id="gene-load-dialog" title="Load Genes">
			<!--<div class="progress-label">Finding Genes...</div>-->
			<div id="progressbar"></div>
		</div>

		<div class="modal fade bs-example-modal-sm" id="modal-form" tabindex="-1" role="dialog" aria-labbeledby="modal-form-label" aria-hidden="true">
			<div class="modal-dialog modal-smd">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title" id="modal-form-label">Multiple genes were found. Choose one from the following</h4>
					</div>
					<div class="modal-body">
						<div class="radio" id="GeneOptions"></div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						<button type="button" class="btn btn-primary" id="loadSpecificGene">Load Genes</button>
					</div>
				</div>
			</div>
		</div>

		<div class="navbar navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">Lightning: 154 PGP Genomes, unphased</a>
				</div>
				<div class="collapse navbar-collapse">
					<form class="navbar-form navbar-right" role="search" id="searchForm" method="get">
						<div class="form-group">
							<input type="text" name="geneName" id="geneName" class="form-control" placeholder="Search for Gene">
						</div>
						<button type="submit" class="btn btn-default">Submit</button>
					</form>
					<!--<form class="navbar-form navbar-right" id="allGenes" method="get">
						<select class="form-control" name="filter" id="filter">
							<option value="" selected="selected">Select a group of genes to view:</option>
							<option value="clinical">Clinically important genes</option>
							{% for option in filters %}
								<option value="{{option}}">{{option}}</option>
							{% endfor %}
						</select>
					</form>-->
				</div><!--/.nav-collapse -->
			</div>
		</div>
		<div class="container-fluid ">
			<div id="contentDiv"></div>
		</div>
	</body>
</html>
